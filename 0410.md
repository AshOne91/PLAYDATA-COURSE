ì¢‹ìŒ. ì•„ë˜ëŠ” ì•ì„œ í†µí•©í•´ì„œ ë³´ë‚´ë“œë¦° Netflix ì£¼ê°€ ì˜ˆì¸¡ RNN ëª¨ë¸ ì „ì²´ ì½”ë“œì˜ **ê° ì½”ë“œ ìŠ¤í…**ê³¼ **íŒŒë¼ë¯¸í„° ì˜ë¯¸**ë¥¼ í•œë•€í•œë•€ **ì„¸ì„¸í•˜ê²Œ** ì„¤ëª…í•œ ê²ƒì„. ê° êµ¬ê°„ë³„ë¡œ ì–´ë–¤ ì—­í• ì„ í•˜ëŠ”ì§€, ì–´ë–¤ íŒŒë¼ë¯¸í„°ê°€ ì–´ë–¤ ì˜ë¯¸ì¸ì§€, ì™œ ê·¸ë ‡ê²Œ ì‚¬ìš©í•˜ëŠ”ì§€ë¥¼ ëª¨ë‘ í¬í•¨í–ˆìŒ.  

---

## âœ… 1. ë°ì´í„° ë¡œë”© ë° ì „ì²˜ë¦¬
```python
import pandas as pd
df = pd.read_csv('/content/train.csv')
df['Date'] = pd.to_datetime(df['Date'])  # ë‚ ì§œ ë¬¸ìì—´ì„ datetimeìœ¼ë¡œ ë³€í™˜
df['year'] = df['Date'].dt.year          # ì—°ë„ë§Œ ì¶”ì¶œí•´ ìƒˆ ì»¬ëŸ¼ ìƒì„±
df.describe()
```

- **`pd.read_csv()`**: CSV íŒŒì¼ì„ DataFrame í˜•íƒœë¡œ ì½ìŒ.
- **`pd.to_datetime()`**: ë¬¸ìì—´ë¡œ ëœ ë‚ ì§œë¥¼ datetime ìë£Œí˜•ìœ¼ë¡œ ë³€í™˜í•´ ì‹œê³„ì—´ ë°ì´í„°ë¡œ í™œìš© ê°€ëŠ¥.
- **`dt.year`**: datetime ì»¬ëŸ¼ì—ì„œ ì—°ë„ë§Œ ì¶”ì¶œ (ì˜ˆ: 2020-05-03 â†’ 2020).

---

## âœ… 2. ë°ì´í„° ì‹œê°í™”
```python
import matplotlib.pyplot as plt
sample = df.iloc[:, 1:4]
sample['Close'] = df['Close']
sample.hist()
plt.show()
```

- **`df.iloc[:, 1:4]`**: Open, High, Low ì»¬ëŸ¼ ì„ íƒ
- **`sample['Close']`**: ì¢…ê°€ë„ ì‹œê°í™”ì— í¬í•¨
- **`.hist()`**: ê° í”¼ì²˜ì— ëŒ€í•œ íˆìŠ¤í† ê·¸ë¨ìœ¼ë¡œ ë¶„í¬ í™•ì¸

---

## âœ… 3. Dataset í´ë˜ìŠ¤ ì •ì˜
```python
from torch.utils.data import Dataset, DataLoader
import numpy as np

class NetflixDataset(Dataset):
  def __init__(self, csv_path):
    df = pd.read_csv(csv_path)
    self.data = df.iloc[:, 1:4].to_numpy()  # Open, High, Low
    self.data = self.data / np.max(self.data)  # ì •ê·œí™” (0~1)
    self.label = df.iloc[:, -1].to_numpy()  # Close ì¢…ê°€
    self.label = self.label / np.max(self.label)  # ì •ê·œí™”
  def __len__(self):
    return len(self.data) - 30  # ì‹œê³„ì—´ ì˜ˆì¸¡ì´ë¯€ë¡œ 30ì¼ì¹˜ ì‚¬ìš©, ë§ˆì§€ë§‰ ì¸ë±ìŠ¤ ì˜ˆì™¸ì²˜ë¦¬
  def __getitem__(self, idx):
    data = self.data[idx:idx+30]  # 30ì¼ ì‹œê³„ì—´ ë°ì´í„°
    label = self.label[idx+30]    # ì˜ˆì¸¡í•  ë‹¤ìŒë‚  ì¢…ê°€
    return torch.tensor(data, dtype=torch.float32), torch.tensor(label, dtype=torch.float32)
```

- **Dataset í´ë˜ìŠ¤ ì—­í• **: `DataLoader`ê°€ ë°°ì¹˜ ë‹¨ìœ„ë¡œ ë°ì´í„°ë¥¼ ìë™ìœ¼ë¡œ ê³µê¸‰í•˜ê²Œ ë„ì™€ì¤Œ.
- `__len__()` : ì „ì²´ ìƒ˜í”Œ ê°œìˆ˜ ë°˜í™˜
- `__getitem__()` : ì¸ë±ìŠ¤ë¥¼ ì…ë ¥ë°›ì•„ (30ì¼ê°„ì˜ ì…ë ¥ ì‹œí€€ìŠ¤, ë‹¤ìŒë‚  ì¢…ê°€) ìŒìœ¼ë¡œ ë°˜í™˜
- **ì •ê·œí™”**: RNNì€ ìˆ˜ì¹˜ ë²”ìœ„ì— ë¯¼ê° â†’ ì•ˆì •ì  í•™ìŠµì„ ìœ„í•´ 0~1 ë²”ìœ„ë¡œ ìŠ¤ì¼€ì¼ë§

---

## âœ… 4. DataLoader ì •ì˜ ë° í™•ì¸
```python
netflix_dataset = NetflixDataset('/content/train.csv')
netflix_dataloader = DataLoader(netflix_dataset, batch_size=32)

data, label = next(iter(netflix_dataloader))
print(data.shape, label.shape)  # (32, 30, 3), (32,)
```

- **`batch_size=32`**: 32ê°œì˜ ìƒ˜í”Œì„ í•œ ë²ˆì— ëª¨ë¸ì— ê³µê¸‰
- **ì…ë ¥ shape**: `(batch_size, sequence_length, input_features)`
  - 32ê°œì˜ ìƒ˜í”Œ
  - ê° ìƒ˜í”Œì€ 30ì¼ ì‹œê³„ì—´
  - í”¼ì²˜ 3ê°œ (Open, High, Low)

---

## âœ… 5. RNN ëª¨ë¸ ì •ì˜
```python
import torch.nn as nn
class NetflixRnn(nn.Module):
  def __init__(self):
    super().__init__()
    self.rnn = nn.RNN(input_size=3, hidden_size=10, num_layers=5, batch_first=True)
    self.linear1 = nn.Linear(in_features=30*10, out_features=100)
    self.linear2 = nn.Linear(in_features=100, out_features=1)
    self.relu = nn.ReLU()

  def forward(self, x, h0):
    x, hn = self.rnn(x, h0)  # x: (batch, 30, 10)
    x = x.reshape(x.size(0), -1)  # flatten: (batch, 30*10)
    x = self.relu(self.linear1(x))
    x = self.linear2(x)
    return x
```

- **`nn.RNN()` íŒŒë¼ë¯¸í„°**:
  - `input_size=3`: ì‹œê³„ì—´ í•˜ë‚˜ë‹¹ íŠ¹ì„± ìˆ˜ (Open, High, Low)
  - `hidden_size=10`: RNN ì€ë‹‰ ìƒíƒœì˜ ì°¨ì›
  - `num_layers=5`: RNN ì¸µì„ 5ê²¹ìœ¼ë¡œ ìŒ“ìŒ
  - `batch_first=True`: ì…ë ¥ í…ì„œê°€ (batch, seq_len, input_size) ìˆœì„œ

- **`linear1`, `linear2`**:
  - RNNì˜ ì¶œë ¥ì„ ì™„ì „ì—°ê²°ì¸µì— ì…ë ¥í•´ ì¢…ê°€ ì˜ˆì¸¡
  - 30ì¼ Ã— 10 hidden â†’ 100 â†’ 1 ê°’ ì¶œë ¥

---

## âœ… 6. ëª¨ë¸ í•™ìŠµ
```python
netflix = NetflixRnn().to(device)
loss_fn = nn.MSELoss()
optim = torch.optim.Adam(netflix.parameters(), lr=1e-4)
epocs = 200
```

- **ì†ì‹¤ í•¨ìˆ˜**: í‰ê·  ì œê³± ì˜¤ì°¨ (MSELoss) â€“ íšŒê·€ ë¬¸ì œì´ë¯€ë¡œ ì‚¬ìš©
- **ì˜µí‹°ë§ˆì´ì €**: Adam â€“ ê°€ì¤‘ì¹˜ ê°±ì‹  ìë™ ì²˜ë¦¬
- **ëŸ¬ë‹ë ˆì´íŠ¸ `lr=1e-4`**: ê°€ì¤‘ì¹˜ í•™ìŠµ ì†ë„ ì¡°ì ˆ

---

## âœ… 7. í•™ìŠµ ë£¨í”„
```python
for epoch in range(epocs):
  iterator = tqdm(netflix_dataloader)
  epoch_loss = 0.0
  for data, label in iterator:
    data, label = data.to(device), label.to(device)
    h0 = torch.zeros(5, data.size(0), 10).to(device)  # (num_layers, batch_size, hidden_size)
    pred = netflix(data, h0)
    loss = loss_fn(pred.squeeze(), label)
    loss.backward()
    optim.step()
    optim.zero_grad()
    epoch_loss += loss.item()
    iterator.set_description(f"loss : {loss.item():.4f}")
  print(f'epoch : {epoch+1}  loss : {epoch_loss / len(netflix_dataloader):.4f}')
```

- **`h0`**: RNNì˜ ì€ë‹‰ìƒíƒœ ì´ˆê¸°í™” â€“ ëª¨ë“  ì‹œí€€ìŠ¤ê°€ ì²˜ìŒë¶€í„° ì‹œì‘í•˜ë¯€ë¡œ ë§¤ë²ˆ 0ìœ¼ë¡œ ì„¤ì •
- **`loss.backward()`**: ì†ì‹¤ í•¨ìˆ˜ì˜ ë¯¸ë¶„ ê³„ì‚° (ì—­ì „íŒŒ)
- **`optim.step()`**: íŒŒë¼ë¯¸í„° ê°±ì‹ 
- **`optim.zero_grad()`**: ì´ì „ ë¯¸ë¶„ê°’ ì œê±°
- **`pred.squeeze()`**: (32,1) â†’ (32,) í˜•íƒœë¡œ ì°¨ì› ë§ì¶¤

---

## âœ… 8. ëª¨ë¸ ì €ì¥
```python
torch.save(netflix.state_dict(), "netflix.pth")
```

- í•™ìŠµëœ ëª¨ë¸ì˜ ê°€ì¤‘ì¹˜ë¥¼ ì €ì¥í•˜ì—¬ ì¬ì‚¬ìš© ê°€ëŠ¥

---

## âœ… ìš”ì•½

| ë‹¨ê³„ | ëª©ì  | ì£¼ìš” í•¨ìˆ˜/íŒŒë¼ë¯¸í„° |
|------|------|--------------------|
| ë°ì´í„° ë¡œë”© | CSV ì½ê³  ì „ì²˜ë¦¬ | `pd.read_csv`, `to_datetime` |
| ì‹œê°í™” | ë¶„í¬ í™•ì¸ | `hist()`, `matplotlib` |
| Dataset ì •ì˜ | ì‹œê³„ì—´ ìŠ¬ë¼ì´ë”© ìœˆë„ìš° êµ¬ì„± | `__getitem__`, `__len__` |
| DataLoader | ë°°ì¹˜ ë‹¨ìœ„ ë°ì´í„° ê³µê¸‰ | `batch_size=32` |
| RNN ëª¨ë¸ | ì‹œê³„ì—´ ì…ë ¥ í•™ìŠµ | `nn.RNN`, `Linear` |
| í•™ìŠµ | ì†ì‹¤ ê³„ì‚°, ê°€ì¤‘ì¹˜ ì—…ë°ì´íŠ¸ | `loss_fn`, `Adam`, `backward` |
| ì €ì¥ | ëª¨ë¸ ì¬ì‚¬ìš© | `torch.save()` |

---

í•„ìš” ì‹œ ì´ ëª¨ë¸ë¡œ ì¶”ë¡ (ì˜ˆì¸¡)ë„ ê°€ëŠ¥í•˜ë©°, `torch.no_grad()`ë¡œ ê°ì‹¸ì„œ ì‚¬ìš©í•˜ë©´ ë¨.  
í•„ìš”í•˜ë©´ ì¶”ë¡  íŒŒíŠ¸ê¹Œì§€ë„ ì˜ˆì œë¡œ ê°™ì´ ë§Œë“¤ì–´ ì¤„ ìˆ˜ ìˆìŒ.  
ì›í•˜ëŠ” ë¶€ë¶„ ë” ìì„¸íˆ ì•Œë ¤ì¤„ê¹Œ?

ì¢‹ìŒ. ìœ„ ì½”ë“œëŠ” **í•™ìŠµì´ ì™„ë£Œëœ RNN ëª¨ë¸ì„ ë¶ˆëŸ¬ì™€ì„œ** ì „ì²´ ë°ì´í„°ì…‹ì— ëŒ€í•´ **ì˜ˆì¸¡ ìˆ˜í–‰ + í‰ê·  ì†ì‹¤(MSE) ê³„ì‚°**í•˜ëŠ” ë‚´ìš©ì„.  
ì•„ë˜ì— í•œ ì¤„ í•œ ì¤„ ì•„ì£¼ ì„¸ì„¸í•˜ê²Œ **ëª¨ë“  ë³€ìˆ˜/êµ¬ë¬¸/íŒŒë¼ë¯¸í„°** ì˜ë¯¸ë¥¼ **ë³´ì¶©ì„¤ëª…**í•¨.

---

## âœ… 1. ëª¨ë¸ ë¡œë“œ
```python
loaded_model = NetflixRnn()
loaded_model.load_state_dict(torch.load('netflix.pth', map_location=device))
loaded_model.eval()
```

- `NetflixRnn()` : í•™ìŠµ ì‹œ ì‚¬ìš©í•œ ë™ì¼í•œ êµ¬ì¡°ì˜ ëª¨ë¸ì„ ë‹¤ì‹œ ìƒì„±
- `load_state_dict(...)` : ì €ì¥ëœ ê°€ì¤‘ì¹˜(`netflix.pth`)ë¥¼ ëª¨ë¸ì— ë¶ˆëŸ¬ì˜´
  - `map_location=device` : GPU/CPU ìƒí™©ì— ë§ê²Œ ìë™ ë¡œë“œ
- `eval()` : ëª¨ë¸ì„ í‰ê°€ ëª¨ë“œë¡œ ì„¤ì •
  - ë“œë¡­ì•„ì›ƒ, ë°°ì¹˜ ì •ê·œí™” ë“±ì„ ë¹„í™œì„±í™”
  - ì˜ˆì¸¡ ì‹œ ë°˜ë“œì‹œ í•„ìš”

---

## âœ… 2. ì˜ˆì¸¡ ë° ì†ì‹¤ ì¸¡ì • ì´ˆê¸°í™”
```python
pred_lists = []
total_loss = 0.0
```

- `pred_lists` : ì˜ˆì¸¡ ê²°ê³¼ê°’ì„ ë¦¬ìŠ¤íŠ¸ì— ì €ì¥
- `total_loss` : ì „ì²´ ë°ì´í„°ì…‹ì— ëŒ€í•œ ëˆ„ì  ì†ì‹¤ê°’ì„ ì €ì¥

---

## âœ… 3. ì¶”ë¡  ë£¨í”„
```python
with torch.no_grad():
```

- `no_grad()` :
  - í‰ê°€ ì‹œ **ê·¸ë˜ë””ì–¸íŠ¸(ê¸°ìš¸ê¸°)** ê³„ì‚° ìƒëµ â†’ ë©”ëª¨ë¦¬/ì†ë„ ì ˆì•½
  - ì¶”ë¡  ì‹œ ë°˜ë“œì‹œ ì‚¬ìš©í•´ì•¼ í•¨

---

### ğŸ” ë£¨í”„ ì‹œì‘
```python
for data, label in netflix_dataloader:
```

- `netflix_dataloader` : `NetflixDataset`ì„ ë°°ì¹˜ ë‹¨ìœ„ë¡œ ì œê³µ
  - `data`: shape (batch_size, 30, 3)
  - `label`: shape (batch_size,)

---

## âœ… 4. ë°ì´í„° ì „ì²˜ë¦¬
```python
label = label.reshape(-1,1).to(torch.float32).to(device)
data = data.clone().detach().to(torch.float32).to(device)
```

- `label.reshape(-1,1)` : (batch_size,) â†’ (batch_size, 1)
  - ëª¨ë¸ ì¶œë ¥ `predict`ì™€ ì°¨ì›ì„ ë§ì¶”ê¸° ìœ„í•¨
- `.to(torch.float32)` : ë°ì´í„° íƒ€ì…ì„ `float32`ë¡œ ë³€í™˜ (ì •í™•í•œ ì—°ì‚° ë³´ì¥)
- `.to(device)` : GPU ë˜ëŠ” CPUë¡œ ì „ì†¡
- `data.clone().detach()` :
  - `clone()` : ì›ë³¸ ë°ì´í„° ë³µì‚¬
  - `detach()` : ì—°ì‚° ê·¸ë˜í”„ì—ì„œ ë¶„ë¦¬ (ë¶ˆí•„ìš”í•œ gradient ì—°ê²° ë°©ì§€)

---

## âœ… 5. ì´ˆê¸° ì€ë‹‰ ìƒíƒœ ì„¤ì •
```python
h0 = torch.zeros(5, data.shape[0], 10).to(device)
```

- `torch.zeros(...)` : ëª¨ë“  ê°’ì´ 0ì¸ í…ì„œ ìƒì„±
- shape: **(num_layers, batch_size, hidden_size)**
  - `5`: RNN ë ˆì´ì–´ ìˆ˜ (ëª¨ë¸ì—ì„œ ì„¤ì •)
  - `data.shape[0]`: í˜„ì¬ ë°°ì¹˜ í¬ê¸°
  - `10`: hidden state í¬ê¸°
- `to(device)` : GPU/CPUë¡œ ì „ì†¡

---

## âœ… 6. ì˜ˆì¸¡ ìˆ˜í–‰
```python
predict = loaded_model(data, h0)
```

- í•™ìŠµëœ `loaded_model`ì— ì…ë ¥ ë°ì´í„°ì™€ ì´ˆê¸° ì€ë‹‰ìƒíƒœ `h0`ë¥¼ ë„£ì–´ ì˜ˆì¸¡ê°’ `predict` ìƒì„±
- `predict` shape: `(batch_size, 1)` â†’ ì˜ˆì¸¡ëœ ì¢…ê°€

---

## âœ… 7. ì˜ˆì¸¡ê°’ ì €ì¥
```python
pred_lists.extend([p.item() for p in predict])
```

- `predict` ê²°ê³¼ë¥¼ `.item()`ìœ¼ë¡œ ì‹¤ìˆ˜ê°’ìœ¼ë¡œ ë³€í™˜ í›„ ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€
- `.extend()` : ë¦¬ìŠ¤íŠ¸ì— ì—¬ëŸ¬ í•­ëª© ì¶”ê°€

---

## âœ… 8. ì†ì‹¤ ê³„ì‚°
```python
loss = loss_fn(predict, label)
total_loss += loss.item()
```

- `loss_fn`: `nn.MSELoss()` â€” í‰ê·  ì œê³± ì˜¤ì°¨
- `loss.item()` : íŒŒì´í† ì¹˜ í…ì„œë¥¼ ì¼ë°˜ ìˆ«ìë¡œ ë³€í™˜
- `total_loss`: ê° ë°°ì¹˜ ì†ì‹¤ê°’ì„ ëˆ„ì 

---

## âœ… 9. ì „ì²´ í‰ê·  ì†ì‹¤ ì¶œë ¥
```python
print(f"loss : {total_loss / len(netflix_dataloader.dataset)}")
```

- `netflix_dataloader.dataset`: ì „ì²´ ìƒ˜í”Œ ìˆ˜
- ì´ ì†ì‹¤ í•©ì„ ì „ì²´ ìƒ˜í”Œ ìˆ˜ë¡œ ë‚˜ëˆ  **í‰ê·  ì†ì‹¤(MSE)** ê³„ì‚°

---

## ğŸ“Œ ìš”ì•½ íë¦„ë„

| ë‹¨ê³„ | ì„¤ëª… |
|------|------|
| ëª¨ë¸ ë¶ˆëŸ¬ì˜¤ê¸° | í•™ìŠµëœ ê°€ì¤‘ì¹˜ ë¡œë“œ, í‰ê°€ ëª¨ë“œ ì „í™˜ |
| `no_grad()` | ì¶”ë¡  ì¤‘ ê·¸ë˜ë””ì–¸íŠ¸ ê³„ì‚° ìƒëµ |
| ë°°ì¹˜ ìˆœíšŒ | ì „ì²´ ë°ì´í„°ì…‹ì„ ìˆœíšŒí•˜ë©° ì˜ˆì¸¡ |
| ì „ì²˜ë¦¬ | float32 ë³€í™˜, GPU ì´ë™ |
| ì€ë‹‰ ìƒíƒœ ì´ˆê¸°í™” | (5, batch_size, 10) í˜•ìƒ ë§ì¶° ì´ˆê¸°í™” |
| ì˜ˆì¸¡ ìˆ˜í–‰ | `model(data, h0)` |
| ê²°ê³¼ ì €ì¥ | `.item()`ìœ¼ë¡œ ì˜ˆì¸¡ê°’ ì €ì¥ |
| ì†ì‹¤ ì¸¡ì • | `MSELoss` ì‚¬ìš© í›„ ëˆ„ì  |
| í‰ê·  ì†ì‹¤ ì¶œë ¥ | ì „ì²´ ìƒ˜í”Œ ìˆ˜ë¡œ ë‚˜ëˆ  ì¶œë ¥ |

---

í•„ìš” ì‹œ ì˜ˆì¸¡ ê²°ê³¼(`pred_lists`)ë¥¼ ì‹¤ì œ ë‚ ì§œì™€ í•¨ê»˜ **ì‹œê°í™”(plot)** í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥í•¨.  
ì˜ˆ: ì‹¤ì œ ì¢…ê°€ì™€ ì˜ˆì¸¡ ì¢…ê°€ë¥¼ ê²¹ì³ì„œ ê·¸ë¦¬ê¸°.

ê·¸ ë¶€ë¶„ë„ ì›í•  ê²½ìš° ì‹œê°í™” ì½”ë“œë„ ì¶”ê°€í•´ ì¤„ ìˆ˜ ìˆìŒ. ê³„ì† ì§„í–‰í• ê¹Œ?
